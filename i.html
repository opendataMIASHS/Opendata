<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>API Note par ville</title>
		<link rel="stylesheet" href="style.css" />
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
		<!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="css/style.css" /> -->
	</head>
	<body>
		<div class="container">
			<form action="i.html" method="get" id="commune" autocomplete="off">
				<h1>Note ma ville</h1>
				<div class="autocomplete">
					<label for="nomCommune">Commune :</label>
					<input type="text" id="nomCommune" name="nomCommune" placeholder="Paris, Lyon, Chateauneuf,..." />
					<small></small>
				</div>
				<button type="submit" class="full">Rechercher</button>
			</form>
		</div>

		<div id="resultat" name="resulat"></div>
		<div id="details">
				<div>
					<h2>Education</h2>
					<p>1,2,3...Que font 3+67/45 ?</p>
					<ul>
						<li name="educationBac">Les résultats au baccalauréat seront affichés ici.</li>
						<li name="educationbBrevet">Les résultats au brevet des collèges seront affichés ici.</li>
					</ul>
				</div>
				<div>
					<h2>Couverture internet</h2>
					<p>Très importante pour jouer à League Of Legend (demandez à Robinou).</p>
					<ul>
						<li name="internet">La couverture internet sera affichée ici.</li>
					</ul>
				</div>
				<div>
					<h2>Consommation en gaz</h2>
					<p>Pensons à la sobriété energétique !</p>
					<ul>
						<li name="gaz">La consommation annuelle sera affichée ici.</li>
					</ul>
				</div>
				<div>
					<h2>Surfaces agricoles bio</h2>
					<p>Quoi de mieux que de venir acheter ses légumes bio en circuit court ?</p>
					<ul>
						<li name="bio">La surface en hectares sera affichée ici.</li>
					</ul>
				</div>
				<div>
					<h2>Score culturel</h2>
					<p>Nos amis ont calculé un score culturel pour chaque ville pour tous les amoureux d'art et d'histoire.</p>
					<ul>
						<li name="culture">Le score culture sera affiché ici.</li>
					</ul>
				</div>
	</div>

		<div>
			<h2>Tu habites ici ? Donne toi aussi une note à ta ville !</h2>
			<p>Pss: C'est totalement anonyme, alors exprime toi.</p>
				<form method="post" action="/post">
				 <div class="wrapper">
				  <input type="button" id="r1" name="rg1" value="5">
				  <label for="r1">&#10038;</label>
				  <input type="radio" id="r2" name="rg1" value="4">
				  <label for="r2">&#10038;</label>
				  <input type="radio" id="r3" name="rg1" value="3">
				  <label for="r3">&#10038;</label>
				  <input type="radio" id="r4" name="rg1" value="2">
				  <label for="r4">&#10038;</label>
				  <input type="radio" id="r5" name="rg1" value="1">
				  <label for="r5">&#10038;</label>
				</div>

				<label for="nomCommune">Commune :</label>
					<input type="text" id="nomCommune" name="nomCommune2" placeholder="Paris, Lyon, Chateauneuf,..." />

				    <input type="submit" value="post">

				  </form>
		</div>
		<footer>
				<p><br/>Réalisé avec amour par la team : Clément GENAY aka Clem, Clémence CORE aka Clem, Robin BIAGIONI aka Robinou, Théodore MICHEL-PICQUE aka Titou et Célia TEYSSIER aka Céliou.<br/>
				<!-- <a href="#">Nous contacter !</a></p> -->
		</footer>

		<script src="celia.js"></script>
		<script>
		let villeChoisieTout=[];
		function autocomplete(inp, arr) {
		  /*the autocomplete function takes two arguments,
		  the text field element and an array of possible autocompleted values:*/
		  var currentFocus;
		  /*execute a function when someone writes in the text field:*/
		  inp.addEventListener("input", function(e) {
					let vv=[];
		      var a, b, i, val = this.value;
		      /*close any already open lists of autocompleted values*/
		      closeAllLists();
		      if (!val) { return false;}
		      currentFocus = -1;
		      /*create a DIV element that will contain the items (values):*/
		      a = document.createElement("DIV");
		      a.setAttribute("id", this.id + "autocomplete-list");
		      a.setAttribute("class", "autocomplete-items");
		      /*append the DIV element as a child of the autocomplete container:*/
		      this.parentNode.appendChild(a);
		      /*for each item in the array...*/
		      // for (i = 0; i < arr.length; i++) {
					i=0;
					let fin=0;
					while (i < arr.length &&  fin<=10) {
		        /*check if the item starts with the same letters as the text field value:*/
		        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
							vv.push(villeToutesInfos[i]);
							fin++;
		          /*create a DIV element for each matching element:*/
		          b = document.createElement("DIV");
		          /*make the matching letters bold:*/
		          b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
		          b.innerHTML += arr[i].substr(val.length);
		          /*insert a input field that will hold the current array item's value:*/
		          b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
		          /*execute a function when someone clicks on the item value (DIV element):*/
		          b.addEventListener("click", function(e) {
		              /*insert the value for the autocomplete text field:*/
		              inp.value = this.getElementsByTagName("input")[0].value;
		              /*close the list of autocompleted values,
		              (or any other open lists of autocompleted values:*/
		              closeAllLists();

		          });
		          a.appendChild(b);
		        }

						i++;
		      }
					villeChoisieTout=vv;
					console.log(vv);
		  });
			console.log(villeChoisieTout);
		  /*execute a function presses a key on the keyboard:*/
		  inp.addEventListener("keydown", function(e) {
		      var x = document.getElementById(this.id + "autocomplete-list");
		      if (x) x = x.getElementsByTagName("div");
		      if (e.keyCode == 40) {
		        /*If the arrow DOWN key is pressed,
		        increase the currentFocus variable:*/
		        currentFocus++;
		        /*and and make the current item more visible:*/
		        addActive(x);
		      } else if (e.keyCode == 38) { //up
		        /*If the arrow UP key is pressed,
		        decrease the currentFocus variable:*/
		        currentFocus--;
		        /*and and make the current item more visible:*/
		        addActive(x);
		      } else if (e.keyCode == 13) {
		        /*If the ENTER key is pressed, prevent the form from being submitted,*/
		        e.preventDefault();
		        if (currentFocus > -1) {
		          /*and simulate a click on the "active" item:*/
		          if (x) x[currentFocus].click();
		        }
		      }
		  });
		  function addActive(x) {
		    /*a function to classify an item as "active":*/
		    if (!x) return false;
		    /*start by removing the "active" class on all items:*/
		    removeActive(x);
		    if (currentFocus >= x.length) currentFocus = 0;
		    if (currentFocus < 0) currentFocus = (x.length - 1);
		    /*add class "autocomplete-active":*/
		    x[currentFocus].classList.add("autocomplete-active");
		  }
		  function removeActive(x) {
		    /*a function to remove the "active" class from all autocomplete items:*/
		    for (var i = 0; i < x.length; i++) {
		      x[i].classList.remove("autocomplete-active");
		    }
		  }
		  function closeAllLists(elmnt) {
		    /*close all autocomplete lists in the document,
		    except the one passed as an argument:*/
		    var x = document.getElementsByClassName("autocomplete-items");
		    for (var i = 0; i < x.length; i++) {
		      if (elmnt != x[i] && elmnt != inp) {
		        x[i].parentNode.removeChild(x[i]);
		      }
		    }
		  }
		  /*execute a function when someone clicks in the document:*/
		  document.addEventListener("click", function (e) {
		      closeAllLists(e.target);
		  });
		}
		let ville=[];
		let villeToutesInfos=[];

		window.onload = function(){

		$.get("C:/Users/33787/Desktop/integration_donnees/france.json", function(data){
				for (var i = 0; i < data.length; i++) {
    				ville.push(data[i].Nom_commune + ", " + data[i].Code_postal);
						villeToutesInfos.push(data[i]);
				}
			});
		}
		// console.log(villeToutesInfos);
		ville=ville.sort();
		/*initiate the autocomplete function on the "myInput" element, and pass along the countries array as possible autocomplete values:*/
		autocomplete(document.getElementById("nomCommune"), ville);


		</script>
	</body>
</html>
